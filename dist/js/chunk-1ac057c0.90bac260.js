(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1ac057c0"],{"129f":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"1fe7":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"content-wrap"},[a("mixSearch",{attrs:{fields:e.searchFields},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),a("div",{staticClass:"info"},[a("span",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handDistribution}},[e._v("手动分配")])],1),a("span",[a("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.autoDistribution(!0)}}},[e._v("自动分配")])],1),e.maxOrder?[a("span",[e._v(" 接待上限： "),a("el-tag",[e._v(e._s(e.maxOrder.limit||"--"))])],1),a("span",[e._v(" 累计接单： "),a("el-tag",[e._v(e._s(e.maxOrder.count||"--"))])],1),e.maxOrder.control?a("span",[e._v(" 暂停接单： "),a("el-switch",{attrs:{"inactive-color":"#ccc"},on:{change:e.stopOrder},model:{value:e.maxOrder.status,callback:function(t){e.$set(e.maxOrder,"status",t)},expression:"maxOrder.status"}})],1):e._e()]:e._e()],2),a("div",{staticStyle:{height:"calc(100% - 160px)"}},[a("mixTable",{attrs:{fields:e.tableFields},on:{select:e.selection},model:{value:e.tableData,callback:function(t){e.tableData=t},expression:"tableData"}})],1),a("mixPage",{model:{value:e.page,callback:function(t){e.page=t},expression:"page"}})],1),a("mixDrawer",{staticStyle:{top:"61px"},attrs:{title:e.drawerName,isShow:!0},on:{confirm:e.onSave,close:e.drawerClose},model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}},[a("mixForm",{key:e.key,attrs:{fields:e.editFields},model:{value:e.editForm,callback:function(t){e.editForm=t},expression:"editForm"}})],1),a("el-dialog",{attrs:{title:e.dialogName,visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[e.show?e._e():a("mixSearch",{attrs:{fields:e.salesSearch},model:{value:e.salesSearchData,callback:function(t){e.salesSearchData=t},expression:"salesSearchData"}}),e.show?e._e():a("mixTable",{attrs:{fields:e.tableSales},model:{value:e.tableSalesData,callback:function(t){e.tableSalesData=t},expression:"tableSalesData"}}),e.show?a("mixForm",{staticStyle:{border:"none"},attrs:{fields:e.addOrderFields},model:{value:e.addOrderData,callback:function(t){e.addOrderData=t},expression:"addOrderData"}}):e._e(),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("关闭窗口")])],1)],1),a("el-dialog",{attrs:{title:"客户二维码",visible:e.qrcode,width:"50%"},on:{"update:visible":function(t){e.qrcode=t}}},[a("mixForm",{staticStyle:{border:"none"},attrs:{fields:e.qrocdeFields},model:{value:e.editForm,callback:function(t){e.editForm=t},expression:"editForm"}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.changeImageSave}},[e._v("确定修改")])],1)],1)],1)},n=[],i=(a("99af"),a("4de4"),a("4160"),a("caad"),a("c975"),a("d81d"),a("ac1f"),a("5319"),a("841c"),a("1276"),a("159b"),a("5530")),s=(a("96cf"),a("1da1")),o={name:"customerManage",data:function(){return{key:"a",show:!1,maxOrder:null,page:{limit:10,page:1,total:0},id:null,drawerName:"编辑",drawer:!1,dialogVisible:!1,dialogName:"选择销售人员",tableFields:[],tableData:[],formFieldsData:{},tableSalesData:{},tableSales:[{label:"昵称",prop:"nickname"},{label:"部门",prop:"saler_group_zid"},{label:"累计接待量",prop:"count"},{label:"最大上限",prop:"limit"},{label:"状态",prop:"status"},{label:"操作",type:"manage",options:[{label:"分配",click:this.onDistribution,style:"primary"}]}],selectList:[],selectionData:{channel:null,source:null,status:null},search:{},searchFields:[{label:"咨询",type:"datetimerange",prop:"date",span:5.5},{label:"模糊匹配",prop:"search",type:"text",span:3},{label:"跟踪状态",type:"select",prop:"trace_status",span:3,options:[]},{label:"客户类型",type:"select",prop:"label",span:3,options:[]},{type:"button",span:10,options:[{label:"搜索",style:"success",click:this.onSearch},{label:"重置",style:"wraning",click:this.onReset},{label:"添加咨询信息",style:"primary",click:this.onAdd,icon:"el-icon-plus"},{label:"导出表格",style:"danger",icon:"el-icon-download",click:this.onExport}]}],salesSearchData:{},salesSearch:[{label:"昵称",type:"text",prop:"search",span:6},{label:"部门",type:"cascader",prop:"saler_group_zid",span:6,config:{emitPath:!1,checkStrictly:!0}},{type:"button",span:3,options:[{label:"搜索",click:this.onSalesSearch,style:"primary"}]}],categorieList:null,options:null,addOrderData:{},addOrderFields:[{label:"业务类型",prop:"business",type:"cascader",options:[],config:{label:"title",value:"id"}},{type:"button",options:[{label:"确定",style:"primary"}]}],qrcode:!1,qrocdeFields:[{label:"修改二维码",type:"image",prop:"screenshot"}],editForm:{},editFields:[],close:null,selectData:null}},watch:{refresh:function(e){e&&(this.getData(),this.$store.commit("setRefresh",!1))},addOrderData:{handler:function(e,t){this.toggleForm(e,t)},deep:!0}},created:function(){},activated:function(){this.init()},computed:{refresh:function(){return this.$store.state.refresh}},methods:{stopMaxOrder:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.axios("/adminapi/Customer/control");case 2:a=t.sent,r=a.data,r.code&&(e.maxOrder=r.data);case 5:case"end":return t.stop()}}),t)})))()},stopOrder:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.axios("/adminapi/Customer/control_update",{data:e.maxOrder});case 2:case"end":return t.stop()}}),t)})))()},init:function(){this.tableFields=[{label:"操作",type:"manage",fixed:"right",width:310,options:[{size:"mini",label:"编辑",style:"success",click:this.tableEdit},{size:"mini",label:"分配",style:"wraning",click:this.distribution},{size:"mini",label:"删除",style:"danger",click:this.tableDel}]}],this.getData(!1),this.getTable(),this.getSelect(),this.stopMaxOrder()},getSelect:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r,n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.axios("/adminapi/Customer/p_tool",{data:{id:4}});case 2:return a=t.sent,r=a.data,r.code&&(e.searchFields=e.searchFields.map((function(e){return"trace_status"==e.prop&&(e.options=r.data),e}))),t.next=7,e.axios("/adminapi/Customer/p_tool",{data:{id:5}});case 7:n=t.sent,i=n.data,i.code&&(e.searchFields=e.searchFields.map((function(e){return"label"==e.prop&&(e.options=i.data),e})));case 10:case"end":return t.stop()}}),t)})))()},changeImage:function(e){this.qrcode=!0,this.editForm={id:e.id,screenshot:e.screenshot}},changeImageSave:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.axios("/adminapi/Customers/CustomersScreenshot",{data:e.editForm});case 2:e.getData(),e.qrcode=!1;case 4:case"end":return t.stop()}}),t)})))()},CategorieList:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.axios("/adminapi/Saleorders/CategorieList");case 2:a=t.sent,r=a.data,r.code&&(e.categorieList=r.data);case 5:case"end":return t.stop()}}),t)})))()},getNaves:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.axios("/adminapi/Saleorders/NavesList");case 2:a=t.sent,r=a.data,r.code&&(e.$set(e.addOrderFields[0],"options",r.data),e.options=r.data);case 5:case"end":return t.stop()}}),t)})))()},getDepartment:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.axios("/adminapi/Customer/dept");case 2:a=t.sent,r=a.data,r.code&&(e.salesSearch=e.salesSearch.map((function(e){return"saler_group_zid"==e.prop&&(e.options=r.data),e})));case 5:case"end":return t.stop()}}),t)})))()},getTable:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.axios("/adminapi/Publics/table_th",{data:{table_id:1}});case 2:a=t.sent,r=a.data,r.code&&(n=r.data.concat(e.tableFields),n.unshift({type:"selection",fixed:"left"},{type:"expand"}),e.tableFields=n);case 5:case"end":return t.stop()}}),t)})))()},getData:function(){var e=arguments,t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,n,i,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=!(e.length>0&&void 0!==e[0])||e[0],n=r?Object.assign({},t.page,t.search):t.page,a.next=4,t.axios("/adminapi/Customer/list",{data:n});case 4:i=a.sent,s=i.data,s.code&&(t.tableData=s.data,t.page.total=s.count);case 7:case"end":return a.stop()}}),a)})))()},onAdd:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r,n,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=[{label:"快捷填单",prop:"referer_info",type:"textarea",input:e.quick}],t.next=3,e.axios("/adminapi/Publics/TableFormEdit",{data:{table_id:1,type:"add"}});case 3:r=t.sent,n=r.data,n.code&&(s={},o=a.concat(n.data),o.forEach((function(e){s[e.prop]=""})),e.editForm=Object(i["a"])(Object(i["a"])({},s),{},{channel:e.editForm.channel}),e.editFields=o.map((function(e){return"mobile"==e.prop&&(e.rule={validator:function(e,t,a){/^\d*$/.test(t)&&/^\d{11}$/.test(t)?a():a(new Error("请输入正确的手机号码"))},trigger:"blur"}),e}))),e.drawerOpen("添加咨询信息"),e.key=Math.random();case 8:case"end":return t.stop()}}),t)})))()},quick:function(e){var t=this;try{this.editForm[e.prop].split("\n").map((function(e){var t=e.split("：");return t[1]?{label:t[0].replace(/\s/g,""),value:t[1].replace(/\s/g,"")}:{label:t[0].replace(/\s/g,""),value:null}})).forEach((function(e){t.editFields.forEach((function(a){e.label.toLocaleLowerCase()==a.label.toLocaleLowerCase()&&(t.editForm[a.prop]=e.value)}))})),this.key=Math.random()}catch(a){this.$message.error("数据解析错误，请手动填写")}},tableEdit:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.axios("/adminapi/Publics/TableFormEdit",{data:{table_id:1,type:"edit"}});case 2:r=a.sent,n=r.data,n.code&&(t.editFields=n.data,t.editForm=e),t.drawerOpen("编辑"),t.key=Math.random();case 7:case"end":return a.stop()}}),a)})))()},change:function(e,t){var a=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var n,i,s,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n={id:e.id},n[t.property]=e[t.property],i="/adminapi/Customer/CustomersEdit",["trace_status","label","qualifications_status","trademark_status"].includes(t.property)&&(i="/adminapi/Customer/traceStatus"),r.next=6,a.axios(i,{data:n});case 6:s=r.sent,o=s.data,o.code&&(a.qrcode=!1);case 9:case"end":return r.stop()}}),r)})))()},selection:function(e){this.id=e.map((function(e){return e.customer_id}))},autoDistribution:function(){var e=arguments,t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,n,i,s,o;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=e.length>0&&void 0!==e[0]&&e[0],t.id){a.next=4;break}return t.$message.error("请选择数据"),a.abrupt("return");case 4:if(!r){a.next=11;break}return a.next=7,t.axios("/adminapi/Customer/many_automatic ",{data:{id:t.id}});case 7:return n=a.sent,i=n.data,i.code&&t.getData(),a.abrupt("return");case 11:return a.next=13,t.axios("/adminapi/Customer/automatic ",{data:{id:t.id}});case 13:s=a.sent,o=s.data,o.code&&t.getData();case 16:case"end":return a.stop()}}),a)})))()},handDistribution:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.id){t.next=3;break}return e.$message.error("请选择数据"),t.abrupt("return");case 3:return e.getDepartment(),t.next=6,e.axios("/adminapi/Customer/refunder");case 6:a=t.sent,r=a.data,r.code&&(e.dialogVisible=!0,e.dialogName="选择接待人员",e.show=!1,e.tableSalesData=r.data);case 9:case"end":return t.stop()}}),t)})))()},onDistribution:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.axios("/adminapi/Customer/manual    ",{data:{uid:e.id,id:t.id}});case 2:r=a.sent,n=r.data,n.code&&t.getData();case 5:case"end":return a.stop()}}),a)})))()},distribution:function(e){var t=this;this.id=e.customer_id,this.$confirm("是否执行自动分配?","提示",{confirmButtonText:"自动分配",cancelButtonText:"手动分配",type:"warning",showClose:!1,closeOnClickModal:!1}).then(Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.autoDistribution();case 1:case"end":return e.stop()}}),e)})))).catch(Object(s["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.handDistribution();case 1:case"end":return e.stop()}}),e)}))))},onSalesSearch:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.axios("/adminapi/Customer/refunder",{data:e.salesSearchData});case 2:a=t.sent,r=a.data,r.code&&(e.tableSalesData=r.data);case 5:case"end":return t.stop()}}),t)})))()},tableDel:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,n,i;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$confirm("此操作不可逆,是否继续！","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",showClose:!1,closeOnClickModal:!1}).catch((function(){}));case 2:if(r=a.sent,r){a.next=5;break}return a.abrupt("return");case 5:return a.next=7,t.axios("/adminapi/Customer/del",{data:{id:e.id}});case 7:n=a.sent,i=n.data,i.code&&t.getData();case 10:case"end":return a.stop()}}),a)})))()},toggleForm:function(e){var t=this,a=[{label:"业务类型",prop:"business",type:"cascader",options:this.options,config:{label:"title",value:"id"}}],r={type:"button",options:[{label:"确定",click:this.onConfirm,style:"primary"}]},n=e.business;if(n[0]){if(1==n[0]){var i;if(8!=n[1]&&9!=n[1]){var o={label:"店铺类型",type:"select",prop:"shop_type",rule:{rule:{required:!1,message:"必填项"},message:"必填项"},options:[{label:"旗舰店",value:"旗舰店"},{label:"专营店",value:"专营店"},{label:"专卖店",value:"专卖店"}]};a.push(o)}var c=[{label:"商标类型",type:"text",rule:{required:!1,message:"必填项"},prop:"trademark_type"},{label:"入驻商标名称",type:"text",rule:{required:!1,message:"必填项"},prop:"trademark_name"},{label:"商标注册号",type:"text",rule:{required:!1,message:"必填项"},prop:"trademarking_number"},{label:"入驻公司",type:"text",rule:{required:!1,message:"必填项"},prop:"entry_company"},{label:"入驻产品",type:"text",rule:{required:!1,message:"必填项"},prop:"settled"},{label:"入驻类目",type:"cascader",prop:"categories",rule:{required:!1,message:"必填项"},options:this.categorieList,config:{label:"title",value:"id",lazy:!0,lazyLoad:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(a,r){var n,i,s,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=a.data.id,e.next=3,t.axios("/adminapi/Saleorders/CategorieList",{data:{pid:n}});case 3:i=e.sent,s=i.data,s.code&&(o=s.data.map((function(e){return e.leaf=!1,e.children||(e.leaf=!0),e})),r(o));case 6:case"end":return e.stop()}}),e)})));function a(t,a){return e.apply(this,arguments)}return a}()}},{label:"合同",type:"upload",rule:{required:!1,message:"必填项"},prop:"contract"}];(i=a).push.apply(i,c)}if(17!==n[1]&&3!==n[0]){var l,u=[{label:"商标名称",type:"text",rule:{required:!1,message:"必填项"},prop:"trademark_name"},{label:"商标类型",type:"text",rule:{required:!1,message:"必填项"},prop:"trademark_type"},{label:"商标注册号",type:"text",rule:{required:!1,message:"必填项"},prop:"trademarking_number"}];(l=a).push.apply(l,u)}a.push({label:"订单金额",type:"number",rule:{required:!1,message:"必填项"},prop:"order_amount"},{label:"备注",type:"textarea",rule:{required:!1,message:"必填项"},prop:"remarks"})}a.push(r);var d=[];a=a.filter((function(e){if(-1==d.indexOf(e.prop))return d.push(e.prop),!0})),this.addOrderFields=a},addOrder:function(e){this.CategorieList(),this.getNaves(),this.addOrderData.customer_id=e.id,this.show=!0,this.dialogVisible=!0,this.dialogName="添加订单"},onSearch:function(){console.log("搜索"),this.getData()},onReset:function(){console.log("重置"),this.search={},this.getData(!1)},drawerOpen:function(e){this.drawer=!0,this.drawerName=e},drawerClose:function(){this.drawer=!1,this.editFields=[]},sizeChange:function(e){this.page.limit=e,this.getData()},currentChange:function(e){this.page.page=e,this.getData()},onExport:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.axios("/adminapi/Customer/CustomersExcel",{data:Object.assign({},e.page,e.search)});case 2:a=t.sent,r=a.data,r.code&&e.$confirm("是否下载导出数据","提示",{confirmButtonText:"下载",cancelButtonText:"取消",type:"warning"}).then((function(){var e=document.createElement("a");e.href=r.data.url,e.setAttribute("target","_blank"),e.setAttribute("download",r.data.title),document.body.appendChild(e),e.click(),document.body.removeChild(e)}));case 5:case"end":return t.stop()}}),t)})))()},onConfirm:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={},e.addOrderFields.forEach((function(t){e.addOrderData[t.prop]&&(a[t.prop]=e.addOrderData[t.prop])})),a.customer_id=e.addOrderData["customer_id"],t.next=5,e.axios("/adminapi/Saleorders/SaleordersAdd",{data:a});case 5:r=t.sent,n=r.data,n.code&&(e.$notify.success({title:"成功",message:n.msg}),e.dialogVisible=!1,e.toggleForm());case 8:case"end":return t.stop()}}),t)})))()},onSave:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a,r,n,i,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.editForm,delete a.quick,r="编辑"==e.drawerName?"edit":"add",t.next=5,e.axios("/adminapi/Customer/"+r,{data:a});case 5:n=t.sent,i=n.data,i.code&&(e.getData(!1),s={},e.editFields.forEach((function(e){return s[e.prop]=null})),s["source"]=e.editForm.source,e.editForm=s,e.drawer=!1);case 8:case"end":return t.stop()}}),t)})))()}}},c=o,l=(a("cd30"),a("2877")),u=Object(l["a"])(c,r,n,!1,null,"6f2d2233",null);t["default"]=u.exports},"3a7e":function(e,t,a){},"841c":function(e,t,a){"use strict";var r=a("d784"),n=a("825a"),i=a("1d80"),s=a("129f"),o=a("14c3");r("search",1,(function(e,t,a){return[function(t){var a=i(this),r=void 0==t?void 0:t[e];return void 0!==r?r.call(t,a):new RegExp(t)[e](String(a))},function(e){var r=a(t,e,this);if(r.done)return r.value;var i=n(e),c=String(this),l=i.lastIndex;s(l,0)||(i.lastIndex=0);var u=o(i,c);return s(i.lastIndex,l)||(i.lastIndex=l),null===u?-1:u.index}]}))},cd30:function(e,t,a){"use strict";var r=a("3a7e"),n=a.n(r);n.a}}]);